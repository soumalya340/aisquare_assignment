<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/SouSimpleStaking.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> SouSimpleStaking.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>18/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>25/25</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "hardhat/console.sol";
&nbsp;
interface ISimpleCoin {
    function mint(address to, uint256 amount) external;
}
&nbsp;
/**
 * @title SimpleStaking
 * @dev A simple staking contract that allows users to deposit ERC20 tokens and earn interest over time.
 * @notice This contract should have the authority to mint new tokens when interest is incurred for the users.
 * @custom:security-considerations The contract assumes it has minting privileges for the staking token.
 */
contract SimpleStaking {
    uint256 public constant INTEREST_RATE = 5; // 5% annual interest rate
    uint256 public constant INTEREST_RATE_DENOMINATOR = 100;
    uint256 public constant SECONDS_PER_YEAR = 31536000; // 365 days
&nbsp;
    mapping(address =&gt; uint256) public depositedTokens; // Tracks the staked balance of each user
    mapping(address =&gt; uint256) public depositTimestamp; // Tracks the timestamp of each user's deposit
&nbsp;
    IERC20 public asset; // The ERC20 token being staked
    address public stakingToken;
&nbsp;
    /**
     * @dev Emitted when a user deposits tokens into the contract.
     * @param user The address of the user making the deposit.
     * @param amount The amount of tokens deposited.
     */
    event Deposit(address indexed user, uint256 amount);
&nbsp;
    /**
     * @dev Emitted when a user withdraws tokens from the contract.
     * @param user The address of the user making the withdrawal.
     * @param amount The amount of tokens withdrawn.
     */
    event Withdraw(address indexed user, uint256 amount);
&nbsp;
    /**
     * @dev Initializes the staking contract with the specified ERC20 token.
     * @param token The address of the ERC20 token to be used for staking.
     */
    constructor(address token) {
        asset = IERC20(token);
        stakingToken = token;
    }
&nbsp;
    /**
     * @notice Deposit a specified amount of tokens into the staking contract.
     * @param _amount The amount of tokens to deposit.
     * @dev The user must have approved the contract to spend at least `_amount` of tokens.
     */
    function deposit(uint256 _amount) public {
        require(_amount &gt; 0, "Deposit amount must be greater than 0");
        require(asset.balanceOf(msg.sender) &gt;= _amount, "Insufficient balance");
&nbsp;
        // If user has an existing deposit, add the new deposit to their balance
        asset.transferFrom(msg.sender, address(this), _amount);
        uint256 interest = calculateInterest(msg.sender);
        // To get the interest
        depositedTokens[msg.sender] += interest;
&nbsp;
        depositedTokens[msg.sender] += _amount;
&nbsp;
        depositTimestamp[msg.sender] = block.timestamp;
        emit Deposit(msg.sender, _amount);
    }
&nbsp;
    /**
     * @notice Withdraw a specified amount of tokens from the staking contract
     * @dev This function allows users to withdraw their staked tokens along with accrued interest
     * @param _amount The amount of tokens to withdraw
     * @custom:requirements
     *   - The withdrawal amount must be greater than 0
     *   - The user must have an active deposit
     *   - The user must have sufficient balance (including interest) to cover the withdrawal
     * @custom:effects
     *   - Calculates and mints accrued interest to the user
     *   - Transfers the requested amount of tokens to the user
     *   - Updates the user's deposited token balance
     *   - Resets the user's deposit timestamp
     * @custom:emits Withdraw event with the user's address and withdrawn amount
     */
    function withdraw(uint256 _amount) public {
        // Ensure the withdrawal amount is valid
        require(_amount &gt; 0, "Withdraw amount must be greater than 0");
&nbsp;
        // Verify that the user has an active deposit
        require(depositTimestamp[msg.sender] != 0, "No active deposit");
&nbsp;
        uint256 interest = calculateInterest(msg.sender);
        // Mint the accrued interest to the user
        // Note: This assumes the staking token has a mint function
        ISimpleCoin(stakingToken).mint(msg.sender, interest);
&nbsp;
        require(depositedTokens[msg.sender] &gt;= _amount, "Insufficient balance");
&nbsp;
        // Transfer the requested amount to the user
        asset.transfer(msg.sender, _amount);
&nbsp;
        // Update the user's deposited token balance
        depositedTokens[msg.sender] = depositedTokens[msg.sender] - _amount;
&nbsp;
        // Reset the deposit timestamp for the remaining balance
        // This ensures interest is only accrued on the remaining balance from this point forward
        depositTimestamp[msg.sender] = block.timestamp;
&nbsp;
        // Emit the Withdraw event
        emit Withdraw(msg.sender, _amount);
    }
&nbsp;
    /**
     * @notice Calculate the accrued interest for a specific user.
     * @param _user The address of the user.
     * @return The amount of interest accrued by the user.
     */
    function calculateInterest(address _user) public view returns (uint256) {
        if (depositTimestamp[_user] == 0) {
            return 0;
        }
&nbsp;
        uint256 timeElapsed = block.timestamp - depositTimestamp[_user];
        uint256 interest = (depositedTokens[_user] *
            INTEREST_RATE *
            timeElapsed) / (INTEREST_RATE_DENOMINATOR * SECONDS_PER_YEAR);
        return interest;
    }
&nbsp;
    /**
     * @notice Get the total balance of a user, including the principal and accrued interest.
     * @param _user The address of the user.
     * @return The total balance of the user.
     */
    function getBalance(address _user) public view returns (uint256) {
        return depositedTokens[_user] + calculateInterest(_user);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Aug 16 2024 11:51:49 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
